<!--prettier-ignore-->
#errorCatcher Echo
#encoding UTF-8
#attr $context = 'day'
#attr $daily_archive = False
#attr $use_parameter_month = False
#attr $use_parameter_year = False

<!DOCTYPE html>
<html lang="$lang">
  <head>
    #include "includes/html-head.inc"
    <title>$station.location - $gettext("Current Weather Conditions")</title>
    #if 'refresh_interval' in $Extras
    <meta http-equiv="refresh" content="$Extras.refresh_interval" />
    #end if
  </head>

  <body class="theme-$DisplayOptions.get('layout', 'alternative')">
    #include "includes/ui-shell.inc"

    <main class="main bx--content">
      <section>
        <div class="bx--grid bx--grid--full-width">
          <div class="bx--row">
            <header class="bx--col page-header">
              <h1>$gettext("Current Weather Conditions")</h1>
              <h2>$current.dateTime</h2>
              <!--prettier-ignore-->
              #if $to_bool($Extras['mqtt']['mqtt_websockets_enabled'])
              #if $DisplayOptions.get('layout', 'alternative') == 'alternative'
                #set $mqtt_notfication_classes = "bx--col-sm-4 bx--col-md-8 bx--col-lg-6 bx--col-xlg-6 bx--col-max-6"
              #else
                #set $mqtt_notfication_classes = "bx--col-sm-4 bx--col-md-8 bx--col-lg-4 bx--col-xlg-4 bx--col-max-4"
              #end if
              <script
                type="module"
                src="https://1.www.s81c.com/common/carbon/web-components/version/v1.25.0/notification.min.js"
              ></script>
              <div
                class="bx--row"
                id="notification-container-mqtt"
                style="display: none"
              >
                <div class="$mqtt_notfication_classes">
                  <bx-inline-notification
                    style="
                      min-width: auto;
                      max-width: none;
                      margin-bottom: 0.5rem;
                    "
                    title="Connected to live weather station."
                    subtitle=""
                  >
                  </bx-inline-notification>
                </div>
              </div>
              #end if
            </header>
          </div>

          <!--prettier-ignore-->
          #if $DisplayOptions.get('layout', 'alternative') == 'alternative'
            #include 'includes/body-alternative.inc'
          #else
            #include 'includes/body-classic.inc'
          #end if
        </div>
      </section>
    </main>

    <!--Stat tile Modals-->
    #if $DisplayOptions.get('layout', 'alternative') == 'alternative' and 'stat_tile_links' in $DisplayOptions
      #for $skin_obs in $DisplayOptions.get('stat_tile_links')
      <script
        type="module"
        src="https://1.www.s81c.com/common/carbon/web-components/tag/v2/latest/modal.min.js"
      ></script>
        #set $render_modal = "stat_tile_links" in $DisplayOptions and $skin_obs in $DisplayOptions["stat_tile_links"] and $DisplayOptions["stat_tile_links"][$skin_obs]["open"] == "modal"
        #set $skin_obs_key = $get_custom_data_binding_obs_key($skin_obs)

        #if $render_modal
          <cds-modal id="modal-example-$skin_obs_key" size="lg" fullWidth>
            <cds-modal-header>
              <cds-modal-close-button></cds-modal-close-button>
              <!-- <cds-modal-label>Label (Optional)</cds-modal-label> -->
              <cds-modal-heading>$obs.label[$skin_obs]</cds-modal-heading>
            </cds-modal-header>
            <cds-modal-body>
              <iframe src='$DisplayOptions["stat_tile_links"][$skin_obs]["link"]' style="width: 100%; height: 100%; border: none;"></iframe>
            </cds-modal-body>
          </cds-modal>

          <script type="text/javascript">
            document
              .querySelector(".stat-tile[data-observation='$skin_obs_key']")
              .addEventListener("click", () => {
                document.getElementById("modal-example-$skin_obs_key").open = true;
              });
          </script>
          <style>
            .stat-tile[data-observation='$skin_obs_key'] {
              cursor: pointer;
            }
            #modal-example-$skin_obs_key cds-modal-body {
              min-height: 65vh;
              overflow: hidden;
            }
          </style>
        #end if
      #end for
    #end if

    <!--Externals Modals-->

    #include "includes/footer.inc"

    <script src="$get_base_path(path='dist/main.js')" defer></script>
    #if $to_bool($Extras['mqtt']['mqtt_websockets_enabled'])
    <script>
      var mqtt_host = "$Extras['mqtt']['mqtt_websockets_host']";
      var mqtt_port = "$Extras['mqtt']['mqtt_websockets_port']";
      var mqtt_topic = "$Extras['mqtt']['mqtt_websockets_topic']";
      var mqtt_ssl = "$Extras['mqtt']['mqtt_websockets_ssl']";
    </script>
    <script src="$get_base_path(path='dist/live-updates.js')" defer></script>
    #end if
  </body>
</html>
